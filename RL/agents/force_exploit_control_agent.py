import RL


class ForceExploitControlAgent(RL.Agent):
    def force_exploits_logic(self):
        if self.context.eval_mode:
            return [True] * self.context.num_envs
        else:
            if self.context.exploit_every is None:
                return [False] * self.context.num_envs
            else:
                minimum_experience_mask = self.runner.num_stepss >= self.context.minimum_experience
                periodic_exploit_mask = self.runner.episode_ids % self.context.exploit_every == 0
                return list(periodic_exploit_mask * minimum_experience_mask)

    def start(self):
        self.context.force_exploits = [False] * self.context.num_envs

    def pre_episode(self, env_id_nos):
        val = self.force_exploits_logic()
        for i in env_id_nos:
            self.context.force_exploits[i] = val[i]
